<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Julian Amon, PhD">
<meta name="dcterms.date" content="2025-04-30">

<title>Exercises IV – cfpu-ds-da</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-1f047e49e03d5949a1de66e547831f65.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-9175887dde49e0f376dc4b42db1796c9.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../exercises/exercises-i.html">Exercises</a></li><li class="breadcrumb-item"><a href="../exercises/exercises-iv.html">Exercises IV</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">cfpu-ds-da</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/jamon-R/cfpu-ds-da" title="GitHub repo to this website" class="quarto-navigation-tool px-1" aria-label="GitHub repo to this website"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Slides</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../getting-started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../introduction-to-ds.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Data Science</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../the-essentials-of-r-programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Essentials of R Programming</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../the-ds-workflow-i.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Data Science Workflow I</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../the-ds-workflow-ii.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Data Science Workflow II</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../the-ds-workflow-iii.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Data Science Workflow III</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../the-ds-workflow-iv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Data Science Workflow IV</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Exercises</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercises-i.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercises I</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercises-ii.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercises II</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercises-iii.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercises III</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercises-iv.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Exercises IV</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Exercise Solutions</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercise-solutions-i.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Solutions I</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercise-solutions-ii.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Solutions II</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercise-solutions-iii.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Solutions III</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercise-solutions-iv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Solutions IV</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datasets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../image_sources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Image Sources</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-data-science-workflow-model" id="toc-the-data-science-workflow-model" class="nav-link active" data-scroll-target="#the-data-science-workflow-model">The Data Science Workflow – Model</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../exercises/exercises-i.html">Exercises</a></li><li class="breadcrumb-item"><a href="../exercises/exercises-iv.html">Exercises IV</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Exercises IV</h1>
<p class="subtitle lead">Data Science and Data Analytics</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Julian Amon, PhD </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 30, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="the-data-science-workflow-model" class="level1">
<h1>The Data Science Workflow – Model</h1>
<ol type="1">
<li>The <code>ISLR2</code> package contains the <code>Boston</code> data set, which records <code>medv</code> (median house value) for 506 suburbs of Boston. We will seek to predict <code>medv</code> using 12 predictors such as <code>rm</code> (average number of rooms per house), <code>age</code> (proportion of owner-occupied units built prior to 1940) and <code>lstat</code> (percent of households with low socio-economic status).
<ol type="a">
<li>Install and load the <code>ISLR2</code> package. Investigate the description of all variables in the <code>Boston</code> data set via <code>?Boston</code>.</li>
</ol>
<ol start="2" type="a">
<li>We will first do a random train-test split. Using the function <code>sample</code>, randomly choose 405 (i.e.&nbsp;approximately 80%) of the observations and assign them to a new <code>data.frame</code> called <code>train</code>. Assign all others to a <code>data.frame</code> called <code>test</code>.</li>
</ol>
<ol start="3" type="a">
<li>Using the training data set, estimate a simple linear regression model with <code>medv</code> as the response and <code>lstat</code> as the predictor. Inspect the created <code>lm</code> object using <code>summary</code> and interpret regression coefficients, their statistical significance and the <span class="math inline">\(R^2\)</span> statistic. Furthermore determine a 95%-confidence interval for the slope coefficient <span class="math inline">\(\beta_1\)</span>.</li>
</ol>
<ol start="4" type="a">
<li>Visualize the simple linear regression model you just fitted on the training data using a scatter plot. Hint: simply use <code>geom_smooth</code> with the method equal to <code>lm</code> and <code>se</code> set to <code>FALSE</code> to add the regression line into the scatter plot. Does the linear fit appear appropriate for the data at hand?</li>
</ol>
<ol start="5" type="a">
<li>Now, estimate a new model that uses the logarithm of <code>lstat</code> as an explanatory variable. Inspect its <span class="math inline">\(R^2\)</span> and compare to the one of the simple model that is linear in <code>lstat</code>. Visualize the corresponding regression line in another scatter plot. Hint: for the visualization of the non-linear regression line, use <code>geom_function</code>. This requires you to specify a function to be drawn into the scatter plot, for which you can use <code>predict</code>.</li>
</ol>
<ol start="6" type="a">
<li>We now want to compare the performance of different linear regression models using 10-fold cross validation. For this, first assign each <strong>training</strong> observation randomly to a fold between 1 and 10. Next, using these folds, determine the test MSE for each of the following linear regression models.
<ul>
<li>M1: <code>medv ~ lstat</code></li>
<li>M2: <code>medv ~ log(lstat)</code></li>
<li>M3: <code>medv ~ log(lstat) + crim</code></li>
<li>M4: <code>medv ~ log(lstat) + crim + dis</code></li>
<li>M5: <code>medv ~ log(lstat) + dis + rm</code></li>
<li>M6: <code>medv ~ log(lstat) + dis + ptratio</code></li>
<li>M7: <code>medv ~ lstat + dis + ptratio + crim + nox</code></li>
<li>M8: <code>medv ~ log(lstat) + dis + ptratio + crim + nox</code></li>
</ul></li>
</ol>
<ol start="7" type="a">
<li>Which of the models investigated in f.&nbsp;gives the lowest test MSE? Fit the corresponding model to the entire training data and investigate the model more deeply using <code>summary</code>.</li>
</ol>
<ol start="8" type="a">
<li>Using your cross-validation setup from f., compare the test MSE performance of the best-performing linear regression model now to the performance of KNN regression models that uses the same variables, i.e.&nbsp;<code>lstat</code>, <code>dis</code>, <code>ptratio</code>, <code>crim</code> and <code>nox</code>. Let <span class="math inline">\(K\)</span> vary between 2 and 10 and only compare the best-performing KNN approach to model M8. Is the non-parametric approach able to outperform the parametric one?</li>
</ol>
<ol type="i">
<li>Using all variables available in the data set, can you find an even better model? Fit your model, the model M8 and the KNN regression model with <span class="math inline">\(K = 5\)</span> from before on the entire <code>train</code> data set. Using these fits, compare the performance of the three models on the initial hold-out <code>test</code> data set from b. Which of the three approaches has the lowest MSE on that data set?</li>
</ol>
<ol start="10" type="a">
<li>Now, fit a regression tree that uses predictors <code>lstat</code>, <code>dis</code>, <code>ptratio</code>, <code>crim</code>, <code>nox</code>, <code>rm</code>, <code>tax</code> and <code>rad</code> to the entire training data. Make sure to set the complexity parameter <code>cp</code> to zero in the fitting process. Visualize the resulting tree using corresponding functionality from the <code>rpart.plot</code> package.</li>
</ol>
<ol start="11" type="a">
<li>Using the created <code>rpart</code> object, determine the optimal complexity parameter <code>cp</code> and create an optimally pruned tree. Finally, use both the unpruned and the optimally pruned tree to predict the response in the initial hold-out <code>test</code> data set from b. How do their MSEs compare to the models investigated in i.? Hint: Prediction with decision trees from <code>rpart</code> works just like it does for linear regression, so that you can use the <code>predict</code> function.</li>
</ol></li>
<li>The <code>ISLR2</code> package also contains the <code>Default</code> data set, which contains information on ten thousand credit card customers. More specifically, the <code>data.frame</code> holds the following four variables: <code>default</code> (a factor with levels <code>No</code> and <code>Yes</code> indicating whether the customer defaulted on their debt), <code>student</code> (a factor indicating whether the customer is a student), <code>balance</code> (average outstanding balance at the end of the month), <code>income</code> (income of the customer in USD).
<ol type="a">
<li>Start by appropriately visualizing the relationship between <code>default</code> (as the response) and each of the other three variables (as the predictors). Also create a scatter plot of <code>balance</code> against <code>income</code>, where the default cases are highlighted via colour and shape.</li>
</ol>
<ol start="2" type="a">
<li>Since the data set is quite big (<span class="math inline">\(n = 10000\)</span>), we can afford to again set some observations aside as a test set for final evaluation. Using the function <code>sample</code>, randomly assign 90% of the observations to a new <code>data.frame</code> called <code>train</code> and assign all others to a <code>data.frame</code> called <code>test</code>.</li>
</ol>
<ol start="3" type="a">
<li>Write a function called <code>binary_class_metrics</code> that takes two <code>factor</code> arguments <code>y_pred</code> and <code>y_true</code>, both with two levels. The first represents the predicted classes and the second represents the true classes. The function is then supposed to return a named vector holding the <code>accuracy</code>, <code>recall</code>, <code>precision</code> and <code>f1</code> score of the binary classification of <code>y_true</code> using <code>y_pred</code>. Test your function for the case where the predictions are <code>1,1,1,0,0,0</code> and the truth is <code>1,1,0,1,1,0</code>. Hint: first compute the confusion matrix by using the function <code>table</code> and then compute the four metrics from that table.</li>
</ol>
<ol start="4" type="a">
<li>On the entire training data, estimate a logistic regression model for the <code>default</code> variable, using the other three variables as predictors. Inspect the model and interpret the coefficients. Which of them are significantly different from zero at the 5% significance level?</li>
</ol>
<ol start="5" type="a">
<li>Employing your function <code>binary_class_metrics</code> from earlier, investigate the <strong>training set</strong> performance of using the logistic regression model from d.&nbsp;as a classifier. Interpret the values of accuracy, recall and precision. Hint: with the <code>fitted</code> function, you can get the estimated default probabilities from your <code>glm</code> object. Be careful to set the factor levels to <code>No</code> and <code>Yes</code> to comply with the <code>default</code> <code>factor</code> in the training data.</li>
</ol>
<ol start="6" type="a">
<li>In the <code>Default</code> data set, we have one categorical predictor, namely whether the customer is a student or not. While logistic regression was easily able to handle that, this is more difficult for KNN classification, as one must decide how to measure distance in a feature space that combines categorical and numerical features. As we have a lot of data, we will follow a simple approach: fitting a separate KNN classifier for students and non-students, both with the same value for <span class="math inline">\(K\)</span>. Use 10-fold cross validation on the training data to find the value for <span class="math inline">\(K\)</span> that maximizes the F1 score. Hint: in every iteration over the 10 folds, fit and predict the students and non-students separately using the two numeric features as predictors. Remember to scale the numeric features in every iteration.</li>
</ol>
<ol start="7" type="a">
<li>Next, fit a classification tree for <code>default</code> using the other three variables as predictors on the entire training data. Make sure to set the complexity parameter <code>cp</code> to zero in the fitting process. Visualize the resulting tree using corresponding functionality from the <code>rpart.plot</code> package.</li>
</ol>
<ol start="8" type="a">
<li>Using the fitted classification tree from g., determine the optimal complexity parameter <code>cp</code> and fit and visualize the optimally pruned classification tree.</li>
</ol>
<ol type="i">
<li>Finally, use the logistic regression model from d., the combined KNN classifier with optimal <span class="math inline">\(K\)</span> from f., the full classification tree from g. and the pruned classification tree from h. to predict the test observations in the initial hold-out sample from b. Feed the predictions of each into your function <code>binary_class_metrics</code> to evaluate their test set performances. Beyond just the metrics, consider the business implications of the different types of errors each model makes:
<ul>
<li>False Positive (Predicting default when the customer will not): What are the potential costs to the credit card company?</li>
<li>False Negative (Predicting no default when the customer will default): What are the potential costs to the credit card company?</li>
<li>Based on these costs and the performance metrics, which model do you think the credit card company might prefer and why? Present the performance metrics in a table and follow it with your discussion.</li>
</ul></li>
</ol></li>
<li>In the course materials, you should find the <code>advertising</code> data set discussed extensively in the lecture. Using 5-fold cross validation, we compared the performance of a linear regression and a KNN regression in class. A linear regression using all three advertising budgets as predictors had an estimated test MSE of 3.06, while a KNN regression with the same predictors and <span class="math inline">\(K=2\)</span>, even had an estimated test MSE of 1.94. The goal is now to additionally examine the performance of a regression tree on that data set.
<ol type="a">
<li>We will start with quite an <strong>advanced</strong> exercise that manually determines the first split in the tree. This is meant to build deeper understanding of what goes on behind the scenes of <code>rpart</code>, but is not strictly necessary, so you can skip ahead to c.&nbsp;if you wish to. The goal here is to write a function that takes two arguments: a vector of training observations of a quantitative feature and a vector of training observations of a quantitative response. The function should return the optimal split point <span class="math inline">\(s\)</span> and the resulting <span class="math inline">\(RSS\)</span> for that variable. Hint: first determine all possible split points of the predictor. Then cycle through the split points, at each point determining the left <span class="math inline">\(RSS\)</span>, the right <span class="math inline">\(RSS\)</span> and then the sum. Save the split points and total <span class="math inline">\(RSS\)</span> in a matrix and return the row of the matrix for which the total <span class="math inline">\(RSS\)</span> is minimized. You may want to write a simple helper function to compute <span class="math inline">\(RSS\)</span>.</li>
</ol>
<ol start="2" type="a">
<li>Now, import the advertising data set and select only the columns 3 to 6 (we do not need the rest). Use your function from a. to determine the optimal split for <code>social_media</code>, for <code>radio</code> and for <code>newspaper</code>, when using <code>sales</code> as a response variable. Which of those three predictors and split points is able to generate the lowest <span class="math inline">\(RSS\)</span>? This will be our first split.</li>
</ol>
<ol start="3" type="a">
<li>If you have not done it so far, import the advertising data set and select only the columns 3 to 6 (we do not need the rest). Employ the <code>rpart</code> package to fit a regression tree for <code>sales</code>, using the other three variables as predictors and setting the complexity parameter <code>cp</code> to zero for the fitting process. Visualize the resulting tree. If you did exercises a. and b., compare the first split (at the very top) to the one you determined in exercise b. Did you come to the same result as the package?</li>
</ol>
<ol start="4" type="a">
<li>Using the fitted regression tree from c., determine the optimal complexity parameter <code>cp</code> and fit and visualize the optimally pruned regression tree for this data set.</li>
</ol>
<ol start="5" type="a">
<li>Finally, determine the test MSE of the optimally pruned tree in 5-fold cross validation. To do this, simply set the complexity parameter <code>cp</code> to the optimal value you found in d.&nbsp;already during fitting in each loop cycle of the cross validation. How does the performance of the optimally pruned regression tree compare to the linear regression and KNN model from the lecture?</li>
</ol></li>
<li>We already know the <code>penguins</code> data set of the <code>palmerpenguins</code> package from the visualization part of this course. We will now try to build classification models for determining the species of penguin based on certain physical characteristics.
<ol type="a">
<li>Load the data set and create a relative frequency table of the different penguin species in the entire data set. What is a crucial difference of this classification task compared to the previous one on defaults of credit card customers in exercise 2.?</li>
</ol>
<ol start="2" type="a">
<li>In the usual way, perform a random 80-20 train-test split. Make sure to remove any NA’s in the data set before you do so.</li>
</ol>
<ol start="3" type="a">
<li>Out of the classification methods that we have learned, the ones that can easily be applied to multi-class classification problems are KNN classification and decision trees. We will start with the former: run a 5-fold cross-validation experiment to determine the accuracy-maximizing value of <span class="math inline">\(K\)</span> for two different KNN classifiers: one that only uses predictors <code>bill_length_mm</code> and <code>bill_depth_mm</code> and one that <strong>additionally</strong> uses predictors <code>flipper_length_mm</code> and <code>body_mass_g</code> to predict <code>species</code>. Make sure you scale the predictors in every iteration over the 5 folds. Hint: it might be helpful to write a little helper function that – given a vector of class predictions and a vector of true classes – computes the accuracy, i.e.&nbsp;the proportion of cases, where predicted class is equal to true class.</li>
</ol>
<ol start="4" type="a">
<li>Now, we will look at a classification tree for this data set. Fit a full classification tree for <code>species</code> based on predictors <code>bill_length_mm</code>, <code>bill_depth_mm</code>, <code>flipper_length_mm</code> and <code>body_mass_g</code> to the training data in the same way you would normally do for a binary classification problem. Determine the optimal complexity parameter <code>cp</code> and use it to also fit an optimally pruned tree. Visualize the outcome. What do you notice about the visualized tree compared to the binary classification case?</li>
</ol>
<ol start="5" type="a">
<li>Use the best-performing KNN model from c.&nbsp;as well as both the full and the optimally pruned tree from d.&nbsp;to predict the species of the penguins in the hold-out test data you created in b. Which of the three models gives the highest test accuracy in predicting the penguin species?</li>
</ol></li>
<li>The Seeds data set (obtainable from <a href="https://archive.ics.uci.edu/dataset/236/seeds">here</a>) contains measurements of geometrical properties of kernels belonging to three different varieties of wheat: Kama, Rosa, and Canadian. Although the target class (variety) is known, we will approach this task as an <strong>unsupervised learning</strong> problem.
<ol type="a">
<li>Download the data set from the given link to the UCI Machine Learning Repository. Note that the data set does not include any column names, so we have to set them manually. From left to right, the columns contain the following measurements: area <span class="math inline">\(A\)</span>, perimeter <span class="math inline">\(P\)</span>, compactness <span class="math inline">\(C = 4\pi \cdot A/P^2\)</span>, length of kernel, width of kernel, asymmetry coefficient, length of kernel groove and wheat variety (1 for Kama, 2 for Rosa or 3 for Canadian). Name the columns of the <code>data.frame</code> accordingly and transform the wheat variety column into a factor with the <code>labels</code> argument set appropriately.</li>
</ol>
<ol start="2" type="a">
<li>Visualize the following bivariate relationships in a scatter plot: <code>perimeter</code> vs.&nbsp;<code>groove_length</code>, <code>kernel_width</code> vs.&nbsp;<code>groove_length</code> and <code>kernel_length</code> vs.&nbsp;<code>groove_length</code>. Do you see any clearly identifiable groups emerging from these bivariate plots?</li>
</ol>
<ol start="3" type="a">
<li>Create a new <code>data.frame</code> called <code>seeds_scaled</code>, which contains all variables except for <code>variety</code> and all of them in their scaled version, i.e.&nbsp;with their mean removed and divided by their standard deviation.</li>
</ol>
<ol start="4" type="a">
<li>On the entire <code>seeds_scaled</code> data set, run K-means clustering with different values of <span class="math inline">\(k\)</span> (e.g.&nbsp;from 1 to 10). In each run, extract the within-cluster sum of squares and store the results in a vector named <code>withinss</code>. Hint: the within-cluster sum of squares can be obtained under the name <code>tot.withinss</code> from the fitted <code>kmeans</code> object.</li>
</ol>
<ol start="5" type="a">
<li>Plot the number of clusters <span class="math inline">\(k\)</span> (on the x-axis) against the values of <code>withinss</code> (on the y-axis). Where is the “elbow” in that plot and which value of <span class="math inline">\(k\)</span> do you deem most appropriate as a consequence?</li>
</ol>
<ol start="6" type="a">
<li>Run K-means clustering again, this time with the optimal <span class="math inline">\(k\)</span> you chose in e. Add the cluster assignment vector (as a factor) to your original <code>data.frame</code> and highlight the identified clusters by colour in the bivariate scatter plots from b. Do they match with your expectations regarding the groups you visually identified in b.?</li>
</ol>
<ol start="7" type="a">
<li>Finally, for each cluster, determine which wheat variety appears in it most frequently and <strong>label</strong> the cluster according to that variety. Then create a cross-tabulation of that label with the actual wheat varieties. How well was the K-means algorithm able to identify wheat varieties without having any information about these classes?</li>
</ol></li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/jamon-R\.github\.io\/cfpu-ds-da\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Copyright 2025, Julian Amon, PhD</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This page is built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>